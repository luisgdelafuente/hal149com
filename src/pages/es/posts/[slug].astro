---
import Layout from "../../../layouts/Layout.astro";
import { getCollection } from 'astro:content';
import { getLangFromUrl } from '../../../i18n/ui';
import BlogImage from '../../../components/BlogImage.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts
    .filter(post => post.data.lang === 'es')
    .map(post => ({
      params: { slug: post.slug },
      props: { post },
    }));
}

const { post } = Astro.props as { post: any };
const { Content } = await post.render();

const lang = getLangFromUrl(Astro.url);
const displayDate: Date = (post.data.updated ?? post.data.date) as Date;
---

<Layout 
  title={post.data.title}
  description={post.data.description}
  image={post.data.image}
  type="article"
  author={post.data.author}
  publishedTime={post.data.date.toISOString()}
  modifiedTime={displayDate.toISOString()}
  section="Blog"
  tags={post.data.tags}
  post={post}
>
  
  <!-- Structured Data for Blog Post -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": post.data.title,
    "description": post.data.description,
    "author": {
      "@type": "Person",
      "name": post.data.author
    },
    "datePublished": post.data.date.toISOString(),
    "dateModified": displayDate.toISOString(),
    "url": `${Astro.url.origin}/es/posts/${post.slug}/`,
    "image": post.data.image ? `${Astro.url.origin}${post.data.image}` : undefined,
    "publisher": {
      "@type": "Organization",
      "name": "HAL149",
      "url": Astro.url.origin
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": `${Astro.url.origin}/es/posts/${post.slug}/`
    },
    "articleSection": "Blog"
  })} />
  <article class="bs-container py-8 sm:py-12 lg:py-16 max-w-4xl">
    <!-- Breadcrumbs -->
    <nav class="mb-8" aria-label="Breadcrumb">
      <ol class="flex items-center space-x-2 text-sm text-bs-foreground-dark">
        <li>
          <a href="/es/" class="hover:text-bs-foreground-light transition-colors">Inicio</a>
        </li>
        <li class="flex items-center">
          <svg class="w-4 h-4 mx-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
          </svg>
          <a href="/es/posts/" class="hover:text-bs-foreground-light transition-colors">Blog</a>
        </li>
        <li class="flex items-center">
          <svg class="w-4 h-4 mx-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
          </svg>
          <span class="text-bs-foreground-light font-medium">{post.data.title}</span>
        </li>
      </ol>
    </nav>

    <!-- Header -->
    <header class="mb-12">
      <!-- Title -->
      <h1 class="bs-h1 mb-6 leading-tight">
        {post.data.title}
      </h1>

      <!-- Meta -->
      <div class="flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-2 sm:gap-4 text-bs-foreground-dark mb-8">
        {post.data.updated ? (
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <span class="font-medium">Actualizado:</span>
            <time datetime={post.data.updated.toISOString()}>
              {post.data.updated.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
          </div>
        ) : (
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <span class="font-medium">Publicado:</span>
            <time datetime={post.data.date.toISOString()}>
              {post.data.date.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
          </div>
        )}
      </div>

      <!-- Featured Image -->
      {post.data.image && (
        <div class="mb-8">
          <BlogImage 
            src={post.data.image} 
            alt={post.data.title}
            width={800}
            height={450}
            class="w-full h-auto object-contain rounded-lg shadow-lg"
            loading="eager"
            fetchpriority="high"
            sizes="(max-width: 480px) 92vw, (max-width: 768px) 90vw, (max-width: 1200px) 800px, 800px"
            quality="mid"
          />
        </div>
      )}
    </header>

    <!-- Content -->
    <div class="post-content max-w-none mb-16">
      <Content />
    </div>
    <hr class="my-8" />
    <div class="text-sm text-bs-foreground-dark space-y-3">
      <div class="flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
        <span class="font-medium">Publicado:</span>
        <time datetime={post.data.date.toISOString()}>
          {post.data.date.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
        </time>
      </div>
      <div class="flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
        <span class="font-medium">Actualizado:</span>
        <time datetime={displayDate.toISOString()}>
          {displayDate.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
        </time>
      </div>
      <div class="flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
        <span class="font-medium">Autor:</span>
        <span>{post.data.author}</span>
      </div>
    </div>
  </article>
</Layout>